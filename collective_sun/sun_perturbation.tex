\documentclass[nofootinbib,notitlepage,11pt]{revtex4-2}

%%% linking references
\usepackage{hyperref}
\hypersetup{
  breaklinks=true,
  colorlinks=true,
  linkcolor=blue,
  filecolor=magenta,
  urlcolor=cyan,
}

%%% header / footer
\usepackage{fancyhdr} % easier header and footer management
\pagestyle{fancy} % page formatting style
\fancyhf{} % clear all header and footer text
\renewcommand{\headrulewidth}{0pt} % remove horizontal line in header
\usepackage{lastpage} % for referencing last page
\cfoot{\thepage~of \pageref{LastPage}} % "x of y" page labeling

%%% symbols, notations, etc.
\usepackage{physics,braket,bm,amssymb} % physics and math
\renewcommand{\t}{\text} % text in math mode
\newcommand{\f}[2]{\dfrac{#1}{#2}} % shorthand for fractions
\newcommand{\p}[1]{\left(#1\right)} % parenthesis
\renewcommand{\sp}[1]{\left[#1\right]} % square parenthesis
\renewcommand{\set}[1]{\left\{#1\right\}} % curly parenthesis
\newcommand{\bk}{\Braket} % shorthand for braket notation

\renewcommand{\c}{\cdot} % inner product

\newcommand{\m}{\bm} % bold symbol
\renewcommand{\v}{\vec} % arrow vector

\usepackage{dsfont} % for identity operator
\newcommand{\1}{\mathds{1}}

\newcommand{\up}{\uparrow}
\newcommand{\dn}{\downarrow}

\renewcommand{\d}{\text{d}}
\newcommand{\x}{\text{x}}
\newcommand{\y}{\text{y}}
\newcommand{\z}{\text{z}}

\newcommand{\A}{\mathcal{A}}
\newcommand{\C}{\mathcal{C}}
\newcommand{\E}{\mathcal{E}}
\newcommand{\G}{\mathcal{G}}
\renewcommand{\H}{\mathcal{H}}
\newcommand{\I}{\mathcal{I}}
\renewcommand{\L}{\mathcal{L}}
\newcommand{\M}{\mathcal{M}}
\newcommand{\N}{\mathcal{N}}
\renewcommand{\O}{\mathcal{O}}
\renewcommand{\P}{\mathcal{P}}
\newcommand{\Q}{\mathcal{Q}}
\renewcommand{\S}{\mathcal{S}}
\newcommand{\T}{\mathcal{T}}
\newcommand{\V}{\mathcal{V}}
\newcommand{\X}{\mathcal{X}}

\newcommand{\DD}{\mathbb{D}}
\newcommand{\PP}{\mathbb{P}}
\newcommand{\RR}{\mathbb{R}}
\renewcommand{\SS}{\mathbb{S}}
\newcommand{\TT}{\mathbb{T}}
\newcommand{\ZZ}{\mathbb{Z}}

\newcommand{\PS}{\text{PS}}
\newcommand{\EQPS}{=_{\text{PS}}}
\newcommand{\col}{\underline}

\DeclareMathOperator{\diag}{diag}
\newcommand{\ul}{\underline}

\usepackage{accents} % for the undertilde
\newcommand{\ut}{\undertilde}

\newcommand{\floor}[1]{\lfloor{#1}\rfloor}
\newcommand{\ceil}[1]{\lceil{#1}\rceil}

\def\obra#1{\mathinner{({#1}|}}
\def\oket#1{\mathinner{|{#1})}}
\def\obk#1{\mathinner{({#1})}}
\def\oop#1#2{\oket{#1}\!\obra{#2}}

\usepackage{mathtools} % for coloneqq

\usepackage[inline]{enumitem} % in-line lists and \setlist{} (below)
\setlist[enumerate,1]{label={(\roman*)}} % default in-line numbering
\setlist{nolistsep} % more compact spacing between environments

%%% figures
\usepackage{graphicx} % for figures
\graphicspath{{./figures/}} % set path for all figures
\usepackage[export]{adjustbox} % for vertical alignment in math
\newcommand{\diagram}[1]
{\,\includegraphics[valign=c]{diagrams/#1.pdf}\,}

%%% text markup
\usepackage{color} % text color
\newcommand{\red}[1]{{\color{red} #1}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}

\title{Perturbing SU($n$)-symmetric interactions}%
\author{Michael A. Perlin}%
\date{\today}

\maketitle

\tableofcontents

\section{Introduction}

We consider an array of $N$ multilevel spins with SU($n$)-symmetric
interactions that can be written in the form
\begin{align}
  H_0 = \sum_{p<q} h_{pq} \Pi_{pq},
  &&
  \Pi_{pq} \equiv \sum_{\mu,\nu} s_{\mu\nu}^{(p)} s_{\nu\mu}^{(q)},
  \label{eq:H_0}
\end{align}
where $p,q$ index individual spins; $\mu,\nu$ index states in an
orthonormal basis for the $n$-dimensional Hilbert space $\H_n$ of a
single spin; $h_{pq}$ are scalar coefficients; the operator
$s_{\mu\nu}^{(p)}\equiv\op{\mu}{\nu}_p$ flips the state of spin $p$ to
$\ket\mu$ from $\ket\nu$; and the operator $\Pi_{pq}$ permutes the
states of spins $p$ and $q$.  The permutation operator $\Pi_{pq}$ is a
multilevel generalization of the SU(2)-symmetric spin interaction
$\v s_p\c\v s_q$ for $\v s=\p{s_\x,s_\y,s_\z}$, with
$s_\alpha=\sigma_\alpha/2$ and $\sigma_\alpha$ a Pauli matrix for an
individual spin.

We wish to determine the effective dynamics induced on the
ground-state manifold $\M_0$ of $H_0$ by weak single- and two-body
perturbations of the form
\begin{align}
  \V_1 \equiv \sum_X \sum_p v_{Xp} X_p = \sum_X \v v_X\c\v X,
  &&
  \V_2 \equiv \sum_O \sum_{p<q} w_{Opq} O_{pq}
  = \sum_O \v{\m w}_O\c \v{\m O}
  \label{eq:perturbations}
\end{align}
where $p,q$ index individual spins; $v_{Xp}$ and $w_{Opq}$ are real
numbers (coefficients); $X$ is a trace-zero single-spin operator on
$\H_n$; $O$ is a trace-zero two-spin operator on $\H_n\otimes\H_n$
that obeys pair-wise permutational symmetry,
i.e.~$O_{pq} = \Pi_{pq} O_{pq} \Pi_{pq} = O_{qp}$; $\v v_X$ and $\v X$
are $N$-component vectors defined by
\begin{align}
  \v v_X \equiv \sum_p v_{Xp} \ket{p},
  &&
  \v X \equiv \sum_p X_p \ket{p};
\end{align}
and finally $\v{\m w_O}$ and $\v{\m O}$ are ${N \choose 2}$-component
vectors defined by
\begin{align}
  \v{\m w}_O \equiv \sum_{p<q} w_{Opq} \ket{\set{p,q}},
  &&
  \v{\m O} \equiv \sum_{p<q} O_{pq} \ket{\set{p,q}},
\end{align}
where the basis vectors $\ket{\set{p,q}}$ are labeled by a choice of
two distinct spins $p,q$.

If the coefficients $h_{pq}$ of the interaction Hamiltonian $H_0$ are
all negative, then the ground-state manifold $\M_0$ of the interaction
Hamiltonian $H_0$ consists of permutationally symmetric states that
are simultaneous $+1$ eigenstates of all permutation operators
$\Pi_{pq}$.  We will adopt the restriction that all $h_{pq}<0$
throughout these notes, but note that this restriction can be relaxed
to the assumption that the initial state of all spins is
permutationally symmetric (e.g.~a spin-polarized state).  We will also
assume throughout these notes that the permutationally symmetric
manifold $\M_0$ is gapped away from all other states by an interaction
energy difference that is large compared to any coupling between
$\M_0$ and its orthogonal complement.  Power-law couplings of the form
$h_{pq}=-h/\abs{p-q}^\alpha$ on a $D$-dimensional lattice, for
example, always yield a non-vanishing spectral gap when $\alpha\le D$
(see Appendix \ref{sec:spectral_gap}).

The effective Hamiltonian $H_M$ induced on the ground-state manifold
$\M_0$ by an $M$-body perturbation $\V_M$ through second order in
perturbation theory is given by\cite{bravyi2011schrieffer,
  perlin2019effective}
\begin{align}
  H_M = H_M^{(1)} + H_M^{(2)},
  &&
  H_M^{(1)} = \P_0 \V_M \P_0,
  &&
  H_M^{(2)} = - \P_0 \V_M \E \V_M \P_0,
  &&
  \E \equiv \sum_{\Delta\ne0} \f{\P_\Delta}{\Delta},
  \label{eq:H_M}
\end{align}
where $\P_\Delta$ is a projector onto the eigenspace of the
interaction Hamiltonian $H_0$ with interaction energy $\Delta$ above
that of permutationally symmetric manifold $\M_0$; that is, the
interaction energy of states in the support of $\P_\Delta$ is
$E_0+\Delta$, where
\begin{align}
  E_0 = \sum_{p<q} h_{pq}
\end{align}
is the interaction energy of permutationally symmetric states
$\ket\psi\in\M_0$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Single-body perturbations}
\label{sec:single_body_pert}

To compute the effective Hamiltonian induced by the single-body
perturbation $\V_1$, we use the permutational symmetry of the
ground-state manifold to simplify
\begin{align}
  H_1^{(1)} = \sum_{X,p} v_{Xp} \P_0 X_p \P_0
  \EQPS \sum_{X,p} v_{Xp} X_1
  \EQPS \sum_X \bar v_X \col{X},
  \label{eq:H_1_1}
\end{align}
where $\EQPS$ denotes equality under a restriction to the
permutationally symmetric manifold $\M_0$, and
\begin{align}
  \bar v_X \equiv \f1N \sum_p v_{Xp},
  &&
  \col{X} \equiv \sum_p X_p,
\end{align}
are respectively the mean value in $\v v_X$ and the collective version
of $X$.  In order to compute the second order effective Hamiltonian
$H_1^{(2)}$, we first choose an arbitrary permutationally symmetric
state $\ket\psi\in\M_0$ and expand (see Appendix \ref{sec:H_V1_psi}):
\begin{align}
  H_0 \V_1 \ket\psi
  = E_0 \V_1 \ket\psi
  + \sum_X \sum_p \p{\sum_q h_{pq} v_{Xq} - h_p v_{Xp}} X_p
  \ket\psi,
  &&
  h_p \equiv \sum_q h_{pq},
  \label{eq:H_V1_psi}
\end{align}
where we define $h_{pq}$ for all $p,q$ (as opposed to only $p<q$) by
enforcing $h_{pq}=h_{qp}$ and $h_{pp}=0$.  We thus find that a
perturbation $\V_1^\Delta\ket\psi$ (indexed by $\Delta$) is an
eigenvector of the interaction Hamiltonian $H_0$ if its coefficient
vectors $\v v_X^\Delta$ all satisfy the eigenvalue equation
\begin{align}
  \p{\m h - \diag\v h}\c\v v = \Delta \v v,
  \label{eq:V1_eig}
\end{align}
where $\m h\equiv\sum_{p,q}h_{pq}\op{p}{q}$ is a matrix of all
couplings $h_{pq}$; the vector $\v h\equiv\sum_{p,q}h_{pq}\ket{p}$ is
the sum of all columns of $\m h$; and $\diag\v h$ is a matrix with
$\v h$ on the diagonal and zeroes everywhere else.  Solving the
general eigenvalue problem in \eqref{eq:V1_eig} requires diagonalizing
the $N\times N$ matrix $\m h-\diag\v h$.  When the interaction
Hamiltonian $H_0$ is translationally invariant, however, this
eigenvalue problem can be solved analytically; we provide the
corresponding solution at the end of Appendix \ref{sec:H_V1_psi}.

If we {\it construct} a perturbation $\V_1^\Delta$ with coefficients
$\v v_X^\Delta$ that satisfy \eqref{eq:V1_eig} with eigenvalue
$\Delta$, then
\begin{align}
  H_0 \V_1^\Delta \ket\psi = \p{E_0 + \Delta} \V_1^\Delta \ket\psi.
\end{align}
Interestingly, the energy of the state $\V_1^\Delta\ket\psi$ depends
only on the coefficients $\v v_X^\Delta$, and is entirely independent
of the state $\ket\psi$ or the choice of a trace-zero single-spin
operator $X$ used to build $\V_1^\Delta$.  Finding operators
$\V_1^\Delta$ that generate eigenvectors of the interaction
Hamiltonian $H_0$ when they act on permutationally symmetric states
$\ket\psi\in\M_0$ thus reduces to finding eigenvectors of the
interaction matrix $\m h-\diag\v h$.

Any coefficient vector $\v v_X$ can be expanded into its projections
$\v v_X^\Delta$ onto the eigenspace of vectors satisfying
\eqref{eq:V1_eig} with eigenvalue $\Delta$,
i.e.~$\v v_X = \sum_\Delta \v v_X^\Delta$, which also allows us to
expand
\begin{align}
  \V_1 = \sum_\Delta \V_1^\Delta,
  &&
  \V_1^\Delta \equiv \sum_X \v v_X^\Delta \c \v X,
\end{align}
where each operator $\V_1^\Delta$ generates a state with definite
interaction energy $\Delta$ above that of the permutationally
symmetric manifold $\M_0$.  We can therefore simplify
\begin{align}
  H_1^{(2)}
  = - \P_0 \V_1 \E \V_1 \P_0
  = - \sum_{\Delta\ne0} \f1{\Delta}
  \P_0 \V_1^\Delta \P_\Delta \V_1^\Delta \P_0
  = - \sum_{\Delta\ne0} \f1{\Delta} \P_0 \p{\V_1^\Delta}^2 \P_0,
\end{align}
where the product $\P_0 \p{\V_1^\Delta}^2 \P_0$ is worked out in
Appendix \ref{sec:PXYP}.  In total, we find that
\begin{align}
  H_1^{(2)}
  \EQPS \f1{N\p{N-1}} \sum_{X,Y} \sum_{\Delta\ne0}
  \f{\v v_X^\Delta\c\v v_Y^\Delta}{\Delta}
  \p{\col{X}\,\col{Y} - N \col{XY}},
  &&
  \col{Z} \equiv \sum_p Z_p.
  \label{eq:H_1_2}
\end{align}
where $\EQPS$ denotes equality under a restriction to the
permutationally symmetric manifold $\M_0$; and $\v v_X^\Delta$ is the
projection of $\v v_X$ onto the $\Delta$-eigenspace of the matrix
$\m h-\diag\v h$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Two-body perturbations}
\label{sec:two_body_pert}

The first-order effective Hamiltonian $H_2^{(1)}$ induced on the
permutationally symmetric manifold $\M_0$ by the two-body perturbation
$\V_2$ in \eqref{eq:perturbations} is simply the restriction of $\V_2$
onto $\M_0$:
\begin{align}
  H_2^{(1)} = \sum_O \sum_{p<q} w_{Opq} \P_0 O_{pq} \P_0
  \EQPS \sum_O \sum_{p<q} w_{Opq} O_{1,2}
  \EQPS \sum_O \bar w_O \col{O},
\end{align}
where
\begin{align}
  \bar w_O \equiv {N \choose 2}^{-1} \sum_{p<q} w_{Opq},
  &&
  \col{O} \equiv \sum_{p<q} O_{pq},
\end{align}
are an average of $w_{Opq}$ and a collective version of the two-spin
operator $O_{pq}$.  If the two-spin operator
$O=X\otimes Y+Y\otimes X$, then
\begin{align}
  H_2^{(1)} \EQPS \f12 \sum_{\p{X,Y}} \bar w_{\p{X,Y}}
  \p{\col{X}\,\col{Y} + \col{Y}\,\col{X} - \col{XY} - \col{YX}}.
\end{align}
In order to compute the second-order effective Hamiltonian
$H_2^{(2)}$, as before we pick an arbitrary permutationally symmetric
state $\ket\psi\in\M_0$ and expand (see Appendix
\ref{sec:eigenstates})
\begin{align}
  H_0 \V_2 \ket\psi
  = E_0 \V_2 \ket\psi
  + \sum_O \sum_{p<q}
  \sp{\sum_k \p{h_{pk} w_{Okq} + h_{qk} w_{Opk}}
  - \bar h_{pq} w_{Opq}}
  O_{pq} \ket\psi,
  \label{eq:H_V2_psi}
\end{align}
where to keep notation compact, we define
\begin{align}
  \bar h_{pq} \equiv h_p + h_q - 2 h_{pq},
  &&
  h_p \equiv \sum_q h_{pq},
\end{align}
and we define $w_{Opq}$ for all $p,q$ (as opposed to only $p<q$) by
enforcing $w_{Opq}=w_{Oqp}$ and $w_{Opp}=0$.  We thus find that the
vector $\V_2^\Delta\ket\psi$ (indexed by $\Delta$) is an eigenvector
of the interaction Hamiltonian $H_0$ if its coefficients
$\v{\m w}_O^\Delta$ all satisfy the eigenvalue equation
\begin{align}
  \check{\m h}_2 \c \v{\m w} = \Delta \v{\m w},
  \label{eq:V2_eig}
\end{align}
where
\begin{align}
  \check{\m h}_2
  \equiv \sum_{p<q} \ket{\set{p,q}} \sp{\sum_{k\notin\set{p,q}}
    \p{h_{pk} \bra{\set{k,q}} + h_{qk} \bra{\set{p,k}}}
    - \bar h_{pq} \bra{\set{p,q}}}.
  \label{eq:V2_eig_mat}
\end{align}
We explicitly exclude $k\in\set{p,q}$ in \eqref{eq:V2_eig_mat} because
these terms vanish in \eqref{eq:H_V2_psi} from the fact that
$h_{kk}=w_{Okk}=0$.  Solving the general eigenvalue problem in
\eqref{eq:V2_eig} requires diagonalizing the
${N \choose 2}\times{N \choose 2}\sim N^2\times N^2$ matrix
$\check{\m h}_2$.  When both he interaction Hamiltonian $H_0$
translationally invariant, however, this eigenvalue problem can be
reduced to that of diagonalizing an $\sim N\times N$ matrix; we
perform this reduction in Appendix \ref{sec:eigenstates_TI}.

If we {\it construct} a perturbation $\V_2^\Delta$ with coefficients
$\v{\m w}_O^\Delta$ that satisfy \eqref{eq:V2_eig} with eigenvalue
$\Delta$, then
\begin{align}
  H_0 \V_2^\Delta \ket\psi = \p{E_0 + \Delta} \V_2^\Delta \ket\psi,
\end{align}
which implies that $\V_2^\Delta\ket\psi$ is a state of definite energy
that depends only on the coefficients $\m w_O^\Delta$.  Similarly to
the case of single-body perturbations, we can decompose any vector
$\v{\m w}_O$ into its projections $\v{\m w}_O^\Delta$ onto the
eigenspace of vectors satisfying \eqref{eq:V2_eig} with eigenvalue
$\Delta$, i.e.~$\v{\m w}_O=\sum_\Delta\v{\m w}_O^\Delta$, which allows
us to expand
\begin{align}
  \V_2 = \sum_\Delta \V_2^\Delta,
  &&
  \V_2^\Delta \equiv \sum_O \v{\m w}_O^\Delta \c \v{\m O},
\end{align}
and in turn write
\begin{align}
  H_2^{(2)} = - \P_0 \V_2 \E \V_2 \P_0
  = -\sum_{\Delta\ne0} \f1\Delta \P_0 \p{\V_2^\Delta}^2 \P_0,
\end{align}
where the product $\P_0 \p{\V_2^\Delta}^2 \P_0$ is simplified in
Appendix \ref{sec:POQP}.  In the special case that
\begin{align}
  \V_2 = \sum_{p<q} w_{pq} s_\z^{(p)} s_\z^{(q)},
\end{align}
where $s_\z\equiv\p{\op\up-\op\dn}/2$ is an SU(2) spin-$z$ operator,
the second-order effective Hamiltonian $H_2^{(2)}$ takes the form
\begin{align}
  H_2^{(2)} \simeq_\PS W_4 S_\z^4 - W_2 S_\z^2,
\end{align}
where $\simeq_\PS$ denotes equality up to scalar terms and a
restriction to the permutationally symmetric manifold;
$S_\z\equiv\sum_p s_\z^{(p)}$ is a collective SU(2) spin operator; and
$W_k$ are scalar coefficients.  In order to expand the coefficients
$W_k$, we define
\begin{align}
  \v{\m w}=\sum_{p<q} w_{pq} \ket{\set{p,q}},
  &&
  \v w \equiv \sum_{p,q} w_{pq} \ket{p},
\end{align}
where $w_{pq}$ is defined for all $p,q$ (as opposed to only $p<q$) by
enforcing $w_{pq}=w_{qp}$ and $w_{pp}=0$.  The vector $\v w$ is the
sum of all columns of the matrix
$\m w\equiv\sum_{p,q}w_{pq}\op{p}{q}$.  We then denote the projection
of $\v{\m w}$ onto the $\Delta$-eigenspace of the matrix
$\check{\m h}_2$ defined in \eqref{eq:V2_eig_mat} by
$\v{\m w}_\Delta$, and define
\begin{align}
  w_{\t{columns}}^{(2)} \equiv \sum_{\Delta\ne0}
  \f{\v w_\Delta\c\v w_\Delta}{\Delta},
  &&
  w_{\t{pairs}}^{(2)} \equiv \sum_{\Delta\ne0}
  \f{\v{\m w}_\Delta\c\v{\m w}_\Delta}{\Delta},
\end{align}
in terms of which
\begin{align}
  W_4 \equiv \f{w_{\t{columns}}^{(2)} - w_{\t{pairs}}^{(2)}}{N!_4},
  &&
  W_2 \equiv \f{w_{\t{columns}}^{(2)} - 2 w_{\t{pairs}}^{(2)}}
  {4N!_2} + \f12 \p{3N-4} W_4,
\end{align}
where
\begin{align}
  N!_k \equiv \prod_{j=0}^{k-1} \p{N-j} = \f{N!}{\p{N-k}!}
\end{align}
denotes a falling factorial.

\newpage
\appendix

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Existence of a spectral gap with power-law interactions}
\label{sec:spectral_gap}

Here we show that power-law SU($n$)-symmetric interactions of the form
in \eqref{eq:H_0} with $h_{pq}=-h/\abs{p-q}^\alpha$ yield a
non-vanishing many-body interaction energy gap when $\alpha\le D$,
where $D$ is the dimension of the lattice.  On a periodic lattice of
$N=L^D$ spins, the spectral gap of the interaction Hamiltonian is (see
Appendix \ref{sec:H_V1_psi})
\begin{align}
  \Delta
  = \sum_{d\in\ZZ_L^D} h_{0,d} \sp{\cos\p{d \c k_{\t{SE}}}-1}
  = h \sum_{\substack{d\in\ZZ_L^D\\\abs{d}\ge1}}
  \f{1-\cos\p{d \c k_{\t{SE}}}}{\abs{d}^\alpha},
\end{align}
where the domain of $d$ is defined in terms of integers modulo $L$,
i.e.~$\ZZ_L\simeq\set{0,1,\cdots,L-1}$ with the relation $\simeq$
denoting an association that ignores the cyclic structure of $\ZZ_L$;
$k_{\t{SE}}\in\ZZ_L\times2\pi/L$ is a wavenumber for a singly-excited
spin-wave state; and the norm $\abs{d}$ for a vector $d$ on a periodic
lattice is implicitly understood to mean the smallest Euclidean
distance of $d$ from a fixed origin.  In order to yield the smallest
excitation energy $\Delta$, the wavenumber $k_{\t{SE}}$ should
maximize the contribution of the cosine term above, which is achieved
by a wavenumber that minimizes the oscillations of this term when
integrated over the entire lattice.  A suitable candidate for a
minimal wavenumber is $k_{\t{SE}}=\p{2\pi/L,0,0,\cdots}$, which
corresponds to an excitation energy
\begin{align}
  \Delta = h \sum_{\substack{d\in\ZZ_L^D\\\abs{d}\ge1}}
  \f{1-\cos\p{d_12\pi/L}}{\abs{d}^\alpha}.
\end{align}
Defining $\epsilon\equiv2/L$ and a rescaled domain symmetrized about
$0$, $\SS_\epsilon\simeq\ZZ_L/\epsilon$ with
$\SS_\epsilon\subset\sp{-1,1}$, we substitute $x\simeq\epsilon d$ to
get
\begin{align}
  \Delta
  = h \sum_{\substack{x\in\SS_\epsilon^D\\\abs{x}\ge\epsilon}}
  \f{1-\cos\p{\pi x_1}}{\abs{x/\epsilon}^\alpha}
  = h \epsilon^{\alpha-D} \sum_{\substack{x\in\SS_L^D\\\abs{x}\ge\epsilon}}
  \epsilon^D \f{1-\cos\p{\pi x_1}}{\abs{x}^\alpha}.
\end{align}
As $\epsilon\to0$ the discrete sum over $x$ becomes an integral that
avoids an infinitesimal region about the origin, i.e.
\begin{align}
  \Delta = h \epsilon^{\alpha-D} \I_{D\epsilon},
  &&
  \I_{D\epsilon}
  \equiv \int_{\TT_1^D\setminus\TT_\epsilon^D} \d^Dx\,
  \f{1-\cos\p{\pi x_1}}{\abs{x}^\alpha},
\end{align}
where the integral $\I_{D\epsilon}$ is defined using the interval
$\TT_a\equiv\p{-a,a}$.  The integrand of $\I_{D\epsilon}$ is strictly
positive and well-behaved on the entirety of its domain except for the
origin, where depending on the value of $\alpha$ the integrand may
vanish or diverge as $\abs{x}\to0$.  Together, these facts mean that
\begin{align}
  \I_{D\epsilon} \stackrel{\epsilon\to0}{\sim} \epsilon^{-\gamma},
  &&
  \Delta \stackrel{\epsilon\to0}{\sim} h \epsilon^{\alpha-D-\gamma},
\end{align}
for some $\gamma\ge0$, which implies that gap $\Delta$ is
non-vanishing when $\alpha\le D\le D+\gamma$.

For the sake of completion, we add that in fact the gap $\Delta$
always vanishes in the thermodynamic limit when $\alpha>D$.  To see
this behavior, we note that the asymptotic dependence of the integral
$I_{D\epsilon}$ on $\epsilon$ is determined by the behavior of its
integrand when $\abs{x}\sim\epsilon$, in which case
$1-\cos\p{\pi x_1}\sim x_1^2$, so
\begin{align}
  \I_{D\epsilon}
  \sim \int_{\TT_1^D\setminus\TT_\epsilon^D} \d^Dx\,
  \f{x_1^2}{\abs{x}^\alpha}.
\end{align}
We can then use the fact that $x_1^2\le\abs{x}^2$ and change to
spherical coordinates to find that
\begin{align}
  \I_{D\epsilon} \lesssim
  \int_{\TT_1^D\setminus\TT_\epsilon^D} \d^Dx\,
  \f{\abs{x}^2}{\abs{x}^\alpha}
  \sim \int_\epsilon^1 \d x\, x^{D+1-\alpha}
  \sim
  \begin{cases}
    \epsilon^0 & \alpha < D+2 \\
    \log\p{1/\epsilon} & \alpha = D+2 \\
    \epsilon^{D+2-\alpha} & \alpha > D+2
  \end{cases}.
\end{align}
It follows that the spectral gap
\begin{align}
  \Delta \stackrel{\epsilon\to0}{\lesssim}
  \begin{cases}
    \epsilon^{\alpha-D} & \alpha < D+2 \\
    \epsilon^2 \log\p{1/\epsilon} & \alpha = D + 2 \\
    \epsilon^2 & \alpha > D+2
  \end{cases},
\end{align}
which vanishes as $\epsilon\to0$ for all $\alpha>D$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Constructing multi-body excitation energy eigenstates}
\label{sec:eigenstates}

In this section, we simplify the products of the form
$H_0\V_M\ket\psi$ to arrive at expansions such as \eqref{eq:H_V1_psi}
and \eqref{eq:H_V2_psi}, which define conditions under which a
multi-body perturbation $\V_M$ generates eigenstates of the
SU($n$)-symmetric interaction Hamiltonian $H_0$ in \eqref{eq:H_0} when
acting on a permutationally symmetric state $\ket\psi\in\M_0$.  Here
$\V_M$ is an $M$-body perturbation of the form
\begin{align}
  \V_M \equiv \sum_{k\in\C_N\p{M}} w_k O_k.
\end{align}
where $O$ is an $M$-spin operator that is invariant under arbitrary
permutation of its tensor factors; $k\equiv\p{k_1,k_2,\cdots,k_M}$ is
a choice of $M$ distinct spins that $O$ acts on; and $\C_N\p{n}$ is
the set of all distinct choices of $n$ elements from a set of size
$N$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Single-body excitations}
\label{sec:H_V1_psi}

As a toy calculation, we first consider the simple case of a
single-body perturbation and simplify
\begin{align}
  H_0 \V_1 \ket\psi
  = \sum_k \sum_{p<q} h_{pq} v_k \Pi_{pq} X_k \ket\psi,
  \label{eq:H_V1_psi_start}
\end{align}
where without loss of generality we consider a single-body
perturbation $\V_1$ built out of only one single-spin operator $X$.
The sum in \eqref{eq:H_V1_psi_start} has terms with $k\in\set{p,q}$,
and terms with $k\notin\set{p,q}$.  In the case of $k\notin\set{p,q}$,
the permutation operator $\Pi_{pq}$ commutes with $X_k$ and
annihilates on $\ket\psi$, leaving terms at each fixed $k$ of the form
\begin{align}
  \sum_{\substack{p<q\\k\notin\set{p,q}}} h_{pq}
  = \sum_{p<q} h_{pq} - \sum_{\substack{p<q\\k\in\set{p,q}}} h_{pq}
  = E_0 - \f12 \sum_{\substack{p,q\\k\in\set{p,q}}} h_{pq}
  = E_0 - h_k,
\end{align}
where we define $h_{pq}$ for all $p,q$ (as opposed to only $p<q$) by
enforcing $h_{pq}=h_{qp}$ and $h_{pp}=0$; and
$h_k \equiv \sum_\ell h_{k\ell}$.  The terms in
\eqref{eq:H_V1_psi_start} with $k\notin\set{p,q}$ are then
\begin{align}
  \sum_{\substack{p<q\\k\notin\set{p,q}}}
  h_{pq} v_k \Pi_{pq} X_k \ket\psi
  = \sum_k \p{E_0 - h_k} v_k X_k \ket\psi
  = E_0 \V_1 \ket\psi - \sum_k h_k v_k X_k \ket\psi
\end{align}
while the terms in \eqref{eq:H_V1_psi_start} with $k\in\set{p,q}$ take
the form
\begin{align}
  \sum_{\substack{p<q\\k\in\set{p,q}}}
  h_{pq} v_k \Pi_{pq} X_k \ket\psi
  = \sum_{k<q} h_{kq} v_k X_q \ket\psi
  + \sum_{p<k} h_{pk} v_k X_p \ket\psi
  = \sum_{k,q} h_{kq} v_k X_q \ket\psi
\end{align}
which implies
\begin{align}
  H_0 \V_1 \ket\psi
  = E_0 \V_1 \ket\psi
  + \sum_p \p{\sum_{q} h_{pq} v_q - h_p v_p}
  X_p \ket\psi.
  \label{eq:H_V1_psi_end}
\end{align}
The action of a single-body perturbation $\V_1=\sum_p v_p X_p$ on a
fully symmetric state therefore generates an eigenstate of $H_0$ with
energy $E_0+\Delta$ if the vector $\v v\equiv\sum_p v_p\ket{p}$
satisfies the eigenvalue equation
\begin{align}
  \p{\m h - \diag\v h} \c \v v = \Delta \v v,
  \label{eq:H_V1_psi_eig}
\end{align}
where $\m h\equiv\sum_{p,q}h_{pq}\op{p}{q}$ is a matrix of all
couplings $h_{pq}$; the vector $\v h\equiv\sum_{p,q}h_{pq}\ket{p}$ is
the sum of all columns of $\m h$; and $\diag\v h$ is a matrix with
$\v h$ on the diagonal and zeroes everywhere else.

When the interaction Hamiltonian $H_0$ is translationally invariant,
the single-body eigenvalue problem in \eqref{eq:H_V1_psi_eig} is
exactly solvable.  In this case, the couplings $h_{pq}$ depend only on
the separation $\abs{p-q}$, so the eigenvectors of $\m h$ are plane
waves of the form
\begin{align}
  \v v_k \equiv \sum_p e^{ip\c k} \ket{p},
\end{align}
where on a $D$-dimensional periodic lattice of $N=L^D$ spins, lattice
sites are indexed by vectors
$p\in\ZZ_L^D\simeq\set{0,1,\cdots,L-1}^{\otimes D}$, and wavenumbers
take on values $k\in\ZZ_L^D\times2\pi/L$.  The corresponding
eigenvalues of $\m h$ can be determined by expanding
\begin{align}
  \m h\c\v v_k = \sum_{p,q} h_{pq} e^{iq\c k} \ket{p}
  = \sum_{p,d} h_{p,p+d} e^{i\p{p+d}\c k} \ket{p}
  = \sum_d h_{0,d} e^{id\c k} \v v_k
  = \sum_d h_{0,d} \cos\p{d\c k} \v v_k,
\end{align}
where the imaginary terms vanish because $h_{0,d}=h_{0,-d}$.  The
remainder of \eqref{eq:H_V1_psi_eig} that we need to sort out is
$\diag\v h$, where all $h_p=\sum_qh_{pq}=\sum_dh_{0,d}$ are equal,
which implies that $\diag\v h=\sum_dh_{0,d}$ is a scalar.  We thus
find that,
\begin{align}
  \p{\m h - \diag\v h}\c\v v_k = \Delta_k \v v_k,
  &&
  \Delta_k \equiv \sum_d h_{0,d} \sp{\cos\p{d\c k}-1}.
\end{align}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Multi-body excitations}
\label{sec:eigenstates}

We now consider the full $M$-body product
\begin{align}
  H_0 \V_M \ket\psi
  = \sum_{\substack{\p{p,q}\in\C_N\p{2}\\k\in\C_N\p{M}}} h_{pq} w_k
  \Pi_{pq} O_k \ket\psi,
  \label{eq:H_VM_psi_start}
\end{align}
where without loss of generality we consider an $M$-body perturbation
$\V_M$ built out of only one $M$-spin operator $O$.  The sum in
\eqref{eq:H_VM_psi_start} has terms with $p,q\in k$, terms with
$p,q\notin k$, and terms with only one of $p$ or $q\in k$.  The
permutation operator $\Pi_{pq}$ acts trivially on $O_k\ket\psi$ when
$p,q\in k$ or $p,q\notin k$, leaving terms at each fixed $k$ of the
form
\begin{align}
  \sum_{\substack{\p{p,q}\in\C_N\p{2}\\p,q\in k~\t{or}~p,q\notin k}} h_{pq}
  = \sum_{\p{p,q}\in\C_N\p{2}} h_{pq}
  - \sum_{p\in k} \sum_{\substack{q\in\ZZ_N\\q\notin k}} h_{pq}
  = E_0 - \sum_{p\in k}
  \p{\sum_{q\in\ZZ_N} h_{pq} - \sum_{q\in k} h_{pq}},
\end{align}
where we first split a sum over $\p{p,q}\in\C_N\p{2}$ with the
restriction that $p,q\in k~\t{or}~p,q\notin k$ into an unrestricted
sum minus a remainder, and then similarly split the sum over all spins
$q$ with the restriction that $q\notin k$ into a sum over all $q$
minus the remainder $q\in k$.  We thus find that
\begin{align}
  \sum_{\substack{\p{p,q}\in\C_N\p{2}\\p,q\in k~\t{or}~p,q\notin k}} h_{pq}
  = E_0 - \bar h_k,
  &&
  \bar h_k \equiv \sum_{p\in k}\p{h_p - \sum_{q\in k}h_{pq}},
  &&
  h_p \equiv \sum_q h_{pq},
\end{align}
which implies that the terms in \eqref{eq:H_VM_psi_start} with
$p,q\in k$ or $p,q\notin k$ are
\begin{align}
  \sum_{k\in\C_N\p{M}} \p{E_0 - \bar h_k} w_k O_k \ket\psi
  = E_0 \V_M \ket\psi
  - \sum_{k\in\C_N\p{M}} \p{\bar{\m h} * \m w}_k O_k \ket\psi,
\end{align}
where $\bar{\m h}$ is a tensor with entries $\bar h_k$; and
$\m x*\m y$ denotes an element-wise (Kronecker) product of $\m x$ and
$\m y$, with entries $x_ky_k$.  The remaining terms in
\eqref{eq:H_VM_psi_start} with only one of $p\in k$ or $q\in k$ are
\begin{align}
  \sum_{k\in\C_N\p{M}} \sum_{\substack{p\in\ZZ_N\\p\notin k}} \sum_{q\in k}
  h_{pq} w_k \Pi_{pq} O_k \ket\psi
  = \sum_{k\in\C_N\p{M}} \sum_{\substack{p\in\ZZ_N\\p\notin k}}
  \sum_{a=1}^M h_{p k_a} w_k \Pi_{p k_a} O_k \ket\psi.
\end{align}
where $k\equiv\p{k_1,k_2,\cdots,k_M}$, with $k_a$ the $a$-th entry in
$k$.  Defining
$k_{ap}\equiv\p{k_1,k_2,\cdots,k_{a-1},p,k_{a+1},\cdots,k_M}$, i.e.~an
element of $\C_N\p{M}$ in which the $a$-th number $k_a$ has been
replaced by $p$, we can simplify
\begin{align}
  \Pi_{p k_a} O_k \ket\psi
  = \Pi_{p k_a} O_k \Pi_{p k_a} \ket\psi
  = O_{k_{ap}}\ket\psi,
\end{align}
and switch the labels for $p$ and $k_a$ to find that
\begin{align}
  \sum_{k\in\C_N\p{M}} \sum_{\substack{p\in\ZZ_N\\p\notin k}} \sum_{q\in k}
  h_{pq} w_k  \Pi_{pq} O_k \ket\psi
  = \sum_{k\in\C_N\p{M}} \sum_{\substack{p\in\ZZ_N\\p\notin k}}
  \sum_{a=1}^M h_{pk_a} w_{k_{ap}} O_k \ket\psi.
\end{align}
For each fixed $a$, the sum over $p$ above is essentially a
contraction of the matrix $\m h$ with the $a$-th index of the tensor
$\m w$.  Denoting such a contraction by $\m h\c_a\m w$, we can
therefore write this result as
\begin{align}
  \sum_{k\in\C_N\p{M}} \p{\m h\circ \m w}_k O_k \ket\psi,
  &&
  \m h\circ\m w \equiv \sum_{a=1}^M \m h\c_a\m w,
\end{align}
where, for clarity, the matrix elements of $\m h\circ\m w$ are
\begin{align}
  \p{\m h\circ\m w}_k
  \equiv \sum_{\substack{p\in\ZZ_N\\p\notin k}} \sum_{a=1}^M
  h_{pk_a} w_{k_{ap}}
  = \sum_{\substack{p\in\ZZ_N\\p\notin k}}
  \p{h_{k_1 p} w_{pk_2k_3\cdots k_M}
    + h_{k_2 p} w_{k_1pk_3\cdots k_M}
    + \cdots + h_{k_M p} w_{k_1k_2\cdots k_{M-1} p}}.
\end{align}
Altogether, we thus find that
\begin{align}
  H_0 \V_M \ket\psi
  = E_0 \V_M \ket\psi + \sum_{k\in\C_N\p{M}}
  \p{\m h\circ\m w - \bar{\m h} * \m w}_k O_k \ket\psi.
  \label{eq:H_VM_psi_end}
\end{align}
The action of the $M$-body perturbation $\V_M$ on a fully symmetric
state therefore generates an eigenstate of $H_0$ with energy
$E_0+\Delta$ if the coefficient tensor $\m w$ satisfies the
generalized eigenvalue equation
\begin{align}
  \m h\circ\m w - \bar{\m h} * \m w = \Delta \m w.
  \label{eq:H_VM_psi_eig}
\end{align}
If $M=1$, then $\p{\m h\circ\m w}_k=\sum_\ell h_{k\ell}w_\ell$ and
$\bar h_k=h_k$, so
\begin{align}
  H_0 \V_1 \ket\psi
  = E_0 \V_1 \ket\psi + \sum_{k\in\ZZ_N}
  \p{\sum_{\ell\in\ZZ_N} h_{k\ell} w_\ell - h_k w_k} O_k \ket\psi,
\end{align}
which is precisely what we found in \eqref{eq:H_V1_psi_end}.  If
$M=2$, then
$\p{\m h\circ\m w}_{pq}=\sum_k\p{h_{pk}w_{kq}+h_{qk}w_{pk}}$, so
\begin{align}
  H_0 \V_2 \ket\psi
  = E_0 \V_2 \ket\psi + \sum_{\p{p,q}\in\C_N\p{2}}
  \sp{\sum_{k\in\ZZ_N}\p{h_{pk} w_{kq} + h_{qk} w_{pk}}
    - \bar h_{pq} w_{pq}}
  O_k \ket\psi,
\end{align}
where $\bar h_{pq}=h_p+h_q-2h_{pq}$ with $h_p\equiv\sum_qh_{pq}$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Translational invariance}
\label{sec:eigenstates_TI}

Solving the eigenvalue problem in \eqref{eq:H_VM_psi_eig} to find
$M$-body perturbations $\V_M$ that generate states of definite
interaction energy nominally requires diagonalizing a matrix with
dimensions ${N\choose M}\times{N\choose M}\sim N^M\times N^M$.  Here,
we simplify this problem to that of diagonalizing a matrix with
dimensions
$\sim{N-1\choose M-1}\times{N-1\choose M-1}\sim N^{M-1}\times N^{M-1}$
when both the interaction Hamiltonian $H_0$ and the perturbation
$\V_M$ are translationally invariant.  This simplification reduces the
computational cost of solving the $M$-body eigenvalue problem by a
factor of $\O\p{N^3}$.

Our task is essentially to express the multi-body eigenvalue problem
in \eqref{eq:H_VM_psi_eig} in a basis that obeys both permutational
symmetry and translational invariance.  To this end, we first expand
the coupling tensor $\m w$ in a complete basis for symmetric tensors:
\begin{align}
  \m w = \sum_{k\in\C_N\p{M}} w_k \m m_k,
  &&
  \m m_k \equiv \sum_{\sigma\in P_M} \m e_{\sigma\p{k}},
  \label{eq:sym_tensor}
\end{align}
where $P_M$ is the set of all permutations of $M$ symbols, and
$\m e_\ell$ is a unit tensor with one in the entry indexed by $\ell$
and zeros everywhere else.  On a $D$-dimensional lattice of linear
size $L$, translational invariance implies that the coefficients $w_k$
remain the same if all spins indexed by $k$ are shifted by the same
displacement $d\in\ZZ_L^D$.  To account for this invariance, we denote
a translation of all spins in $k$ by a displacement $d\in\ZZ_L^D$ by
$k_d$, and define the translation-symmetrized basis tensors
\begin{align}
  \m m_k^{\t{TS}}
  \equiv \f1{\N_k^{\t{TS}}} \sum_{d\in\ZZ_L^D} \m m_{k_d}
  = \f1{\N_k^{\t{TS}}} \sum_{d\in\ZZ_L^D} \sum_{\sigma\in P_M}
  \m e_{\sigma(k_d)},
\end{align}
where the normalization factor $\N_k^{\t{TS}}$ enforces that the
entries of $\m m_k^{\t{TS}}$ are all either zero or one, which
otherwise might not occur if some translations of $k$ results in the
same choice of spins.  We then define the set $\T_{LD}\p{M}$ of
equivalence classes in $\C_N\p{M}$ under arbitrary translations on
$D$-dimensional lattice of linear size $L$, and expand
\begin{align}
  \m w = \sum_{k\in\T_{LD}\p{M}} w_k \m m_k^{\t{TS}}.
  \label{eq:sym_shift_tensor}
\end{align}
Having expanded $\m w$ in a basis that respects permutational symmetry
and translational invariance, we need to express the eigenvalue
equation \eqref{eq:H_VM_psi_eig} in the same basis.  In order to do
so, we label spins $p,q$ by the position of the corresponding lattice
site in $\ZZ_L^D$, and use translational invariance of the couplings
$\m h$ to expand
\begin{align}
  \m h \equiv \sum_{p,q\in\ZZ_L^D} h_{pq} \op{p}{q}
  = \sum_{q,d\in\ZZ_L^D} h_{q+d,q} \op{q+d}{q}
  = \sum_{d\in\ZZ_L^D} h_{d,0} \m s_d,
  &&
  \m s_d \equiv \sum_{q\in\ZZ_L^D} \op{q+d}{d}.
\end{align}
Starting from this form of $\m h$ and the expansion of $\m w$ in
\eqref{eq:sym_tensor}, we can work out that
\begin{align}
  \m h\circ\m w
  = \sum_{k\in\T_{LD}\p{M}} \sum_{d\in\ZZ_L^D} \sum_{a=1}^M w_{k_{d;a}}
  h_{d,0} w_{k_{d;a}} \m m_k^{\t{TS}},
\end{align}
where $k_{d;a}$ denotes the spins acquired by displacing the $a$-th
spin of $k$ by $d$.  With a bit of additional work, we can also
simplify
\begin{align}
  \bar{\m h}
  = \sum_{k\in\T_{LD}\p{M}} \sp{M h_0 - \sum_{p,q\in k} h_{pq}}
  \m m_k^{\t{TS}},
  &&
  h_0 \equiv \sum_{d\in\ZZ_L^D} h_{d,0},
\end{align}
which implies that
\begin{align}
  \bar{\m h} * \m w = M h_0 \m w
  - \sum_{k\in\T_{LD}\p{M}} \sum_{p,q\in k} h_{pq} w_k \m m_k^{\t{TS}}.
\end{align}
Putting everything together, the generalized eigenvalue problem in
\eqref{eq:H_VM_psi_eig} can be written in the form
\begin{align}
  \sum_{k\in\T_{LD}\p{M}} \sp{\sum_{p,q\in k} h_{pq} w_k
    + \sum_{d\in\ZZ_L^D} h_{d,0} \sum_{a=1}^M w_{k_{d;a}}}
  \m m_k^{\t{TS}}
  = \p{M h_0 + \Delta} \m w,
\end{align}
or equivalently
\begin{align}
  \check{\m h} \c \v{\m w} = \p{M h_0 + \Delta} \v{\m w},
  \label{eq:H_VM_eig_simp}
\end{align}
where
\begin{align}
  \check{\m h} \equiv
  \sum_{k\in\T_{LD}\p{M}} \ket{k}
  \sp{\sum_{p,q\in k} h_{pq} \bra{k}
    + \sum_{d\in\ZZ_L^D} h_{d,0} \sum_{a=1}^M \bra{k_{d;a}}},
  &&
  \v{\m w} \equiv \sum_{k\in\T_{LD}\p{M}} w_k \ket{k},
\end{align}
and, to keep notation simple, we define $\ket{k}=0$ for all $k$ with
repeated values, and enforce $\ket{j}=\ket{k}$ if spins $j$ and spins
$k$ are the same up to a global translation.  The matrix
$\check{\m h}$ has dimensions
$\abs{\T_{LD}\p{M}}\times\abs{\T_{LD}\p{M}}$, where
$\abs{\T_{LD}\p{M}} \approx { N-1 \choose M-1 }/M \sim N^{M-1}$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Operator products restricted to the permutationally symmetric
  manifold}
\label{sec:sym_prod}

Weak $M$-body perturbations $\V_M$ to SU($n$)-symmetric interactions
can be treated perturbatively, resulting in an effective Hamiltonian
on a permutationally symmetric manifold $\M_0$ of $N$ spins.
Computing this effective Hamiltonian generally requires multiplying
several operators, and projecting the resulting product onto $\M_0$.
Even if the perturbation $\V_M$ is too strong for rigorous
perturbative treatment, as long as it is comparable in magnitude to
the energetic penalty incurred by breaking permutational symmetry, its
effects can still be accounted for by an effective theory on the joint
manifold of permutationally symmetric states together with states of
``weak'' permutational symmetry breaking, e.g.~the manifold of states
generated by the action of $M$-body perturbations on permutationally
symmetric states.  The expansion of operators in a basis for this
joint manifold likewise requires multiplying several operators and
projecting the resulting product onto $\M_0$.  Specifically, if
$\V_M=\sum_{k\in\C_N\p{M}}w_kO_k$, then we can define operators
\begin{align}
  \V_M^{(k)} \equiv \sum_{p\in\C_N\p{M}} w^{(k)}_p O_p,
\end{align}
where $\set{w^{(k)}}$ forms a complete basis for the set of symmetric
tensors of dimension $M$ with zeros on all diagonals (i.e.~zero in all
entries with a repeated index).  Denoting a complete basis of
permutationally symmetric states by $\set{\ket{m}}$, we can then
identify the $M$-body perturbed states
\begin{align}
  \ket{mk} \equiv \f1{\sqrt{\N_{mk}}} \V_M^{(k)} \ket{m},
  &&
  \N_{mk} \equiv \bk{m | \V_M^{(k)} \V_M^{(k)} | m}.
\end{align}
The restriction of a multi-body operator $\Q=\sum_p v_p Q_p$ to this
expanded Hilbert space is then
\begin{align}
  \Q =_M \P_M \Q \P_M,
  &&
  \P_M \equiv \sum_m \op{m} + \sum_{m,k} \op{mk},
\end{align}
where $=_M$ denotes equality up to a restriction to the support of
$\P_M$, and finding matrix elements of $\Q$ now requires computing
products of the form
\begin{align}
  \bk{\ell | \V_M^{(j)} \Q \V_M^{(k)} | m}
  = \sum_{p,q,r} w^{(j)}_p v_q w^{(k)}_r \bk{\ell | O_p Q_q O_r | m}.
  \label{eq:example_prod}
\end{align}
The purpose of this section is to work out such products in a
systematic way.  To this end, we derive a general diagrammatic
expansion of these products, as well as rules to simplify the
resulting expansions so as to minimize their computational cost.
These diagrammatic methods allow us to algorithmically evaluate
products such as \eqref{eq:example_prod} from the bare multi-body
operator data $\p{w^{(j)},O},\p{v,Q},\p{w^{(k)},O}$.  We then work out
some special cases of products that are relevant to the perturbation
theory in Sections \ref{sec:single_body_pert} and
\ref{sec:two_body_pert}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{The general case: a diagrammatic expansion}

Given a system of $N$ spins, we wish to project a product of
multi-body operators onto the permutationally symmetric manifold.  For
$p$ multi-body operators, the projection of such a product takes the
form
\begin{align}
  \P_0 \sp{\prod_{j\in\ZZ_p}
    \sum_{k\in\C_N\p{M_j}} w_j\p{k} O_j\p{k}} \P_0,
  \label{eq:sym_prod_proj}
\end{align}
where $\P_0$ is a projector onto the permutationally symmetric
manifold; $k\in\C_N\p{M_j}$ is a choice of $M_j$ distinct spins;
$O_j\p{k}$ denotes the action of an $M_j$-spin operator on spins $k$
that is invariant under permutations of $k$; and $w_j\p{k}$ is a
scalar coefficient for $O_j\p{k}$.

To simplify the product in \eqref{eq:sym_prod_proj}, we first write
\begin{align}
  \prod_{j\in\ZZ_p} \sum_{k\in\C_N\p{M_j}} w_j\p{k} O_j\p{k}
  = \prod_{j\in\ZZ_p} \f1{M_j!} \sum_{k\in\ZZ_N^{M_j}}
  w_j\p{k} O_j\p{k},
  \label{eq:sym_prod_vec}
\end{align}
where we extend the definitions of $w_j\p{k}$ and $O_j\p{k}$ to all
vectors $k\in\ZZ_N^{M_j}$ by defining symmetric dimension-$M_j$
tensors $w_j$ and $O_j$ (i.e.~tensors with $M_j$ indices, with $O_j$
an {\it operator-valued} tensor) for which $w_j\p{k}=O_j\p{k}=0$ if
$k$ contains any repeated symbols.  We then collect terms whose
operator content is equivalent up to a permutation of spins.  To this
end, we classify terms in \eqref{eq:sym_prod_vec} by the numbers $g_S$
of indices shared by all tensors $w_j,O_j$ with $j\in S\subset\ZZ_p$.
For example, a term of the form
$w_1\p{a,b,c} w_2\p{b,d,e} w_3\p{b,c,d,e}$ with distinct indices
$\p{a,b,c,d,e}\in\C_N\p{5}$ would have
\begin{align}
  g_{\set{1}} = 1,
  &&
  g_{\set{1,2,3}} = 1,
  &&
  g_{\set{1,3}} = 1,
  &&
  g_{\set{2,3}} = 2,
\end{align}
and $g_S=0$ for all other subsets $S\subset\ZZ_3$.  This index
assignment can be represented by the Venn diagram
\begin{align}
  \diagram{example_123},
  \label{eq:venn_diagram}
\end{align}
where $g_S$ is determined the number of dots at the intersection of
circles $\set{w_j:j\in S}$.  We denote an assignment of distinct
indices according to choices of $g_S$ for all $S\in\PP\p{\ZZ_p}$ by
$g$, where $\PP\p{\ZZ_p}$ is the power set (i.e.~set of all subsets)
of $\ZZ_p$.  Given a vector $\m M$ of the dimensions $M_j$, we then
denote the set of all valid index assignments $g$ by $\G\p{\m M}$.
For consistency, all valid index assignments $g\in\G\p{\m M}$ must
assign exactly $M_j$ indices to the dimension-$M_j$ tensor $w_j$,
i.e.~
\begin{align}
  \sum_{S\in\PP\p{\ZZ_p}\,:\,j\in S} g_S
  = \sum_{R\in\PP\p{\ZZ_p\setminus\set{j}}} g_{\set{j}\cup R}
  = M_j
\end{align}
for all $j\in\ZZ_p$.  In order to make the index assignments
determined by choices of $g_S$ for all $S\in\PP\p{\ZZ_p}$ unique, we
also enforce that $g_{\set{}}=0$ for all $g\in\G\p{\m M}$, which is
equivalent to saying that every dot in the corresponding Venn diagram
must lie within some circle.  The set of valid index assignments
$\G\p{\m M}$ is then essentially the set of all Venn diagrams of the
form in \eqref{eq:venn_diagram} with $p=\dim\p{\m M}$ circles and a
total of $M_j$ dots within circle $w_j$.

A classification of terms in \eqref{eq:sym_prod_vec} by index
assignments $g\in\G\p{\m M}$ allows us to expand
\begin{align}
  \prod_{j\in\ZZ_p} \sum_{k\in\ZZ_N^{M_j}} w_j\p{k} O_j\p{k}
  \EQPS \sum_{g\in\G\p{\m M}} \S\p{g} w\p{g} O\p{g},
  \label{eq:sym_prod_group_start}
\end{align}
where $\EQPS$ denotes equality up to a restriction to the
permutationally symmetric manifold; $O\p{g}$ is an operator acquired
by assigning indices to the tensors $O_j$ in a manner consistent with
$g$; $w\p{g}$ is a scalar acquired by summing over all indices
assigned to the tensors $w_j$ according to $g$; and $\S\p{g}$ is a
symmetry factor accounting for the number of ways to assign indices
according to $g$.

In order to write out the factors in \eqref{eq:sym_prod_group_start}
explicitly, we identify the set of values that the distinct indices
assigned according to $g$ can take:
\begin{align}
  \C_N\p{g}
  \equiv \set{ k \in \bigotimes_{S\in\PP\p{\ZZ_p}} \C_N\p{g_S}
    : \t{all elements of $k$ are distinct} },
  \label{eq:index_values}
\end{align}
where each $k\in\C_N\p{g}$ has the natural decomposition
$k=\p{k_S:S\in\PP\p{\ZZ_p}}$ with $k_S\in\C_N\p{g_S}$.  In words,
$\C_N\p{g}$ consists of all the ways to choose, for each subset $S$ of
the tensors $\set{w_j}$, a set $k_S$ of $g_S$ distinct spins, with the
restriction that all $k_S$ are orthogonal: if $z\in k_S$, then
$z\notin k_R$ for $R\ne S$.  Having defined the set $\C_N\p{g}$ of
index values, we define the restriction of $k\in\C_N\p{g}$ to values
associated with $w_j$ and $O_j$:
\begin{align}
  k_j \equiv \bigcup_{S\in\PP\p{\ZZ_p} : j\in S} k_S
  = \bigcup_{R\in\PP\p{\ZZ_p\setminus\set{j}}} k_{\set{j}\cup R},
\end{align}
where the union of lists $k_S$ denotes a concatenation of those lists.
These definitions allow us to expand
\begin{align}
  w\p{g} \equiv \sum_{k\in\C_N\p{g}} \prod_{j\in\ZZ_p} w_j\p{k_j},
  &&
  O\p{g} \equiv \prod_{j\in\ZZ_p}
  O_j\p{\ell_j}~\t{for some}~\ell\in\C_N\p{g},
  \label{eq:diagram_factors}
\end{align}
where the choice of $\ell\in\C_N\p{g}$ does not matter after
projection onto permutationally symmetric manifold, and
\begin{align}
  \S\p{g} \equiv \sp{\prod_{j\in\ZZ_p} \C\p{ g_S : j\in S }}
  \sp{\prod_{S\in\PP\p{\ZZ_p}} \p{g_S!}^\abs{S}}
  = \prod_{j\in\ZZ_p} M_j!,
  \label{eq:sym_prod_symmetry}
\end{align}
where the first product in \eqref{eq:sym_prod_symmetry} contains
multinomial coefficients
\begin{align}
  \C\p{a_1,a_2,\cdots,a_m}
  \equiv \f{\p{a_1+a_2+\cdots+a_m}!}{a_1!a_2!\cdots a_m!}
\end{align}
that account for the number of ways to partition the indices of each
$w_j,O_j$ into sets of shared indices as specified by $g$, and the
second product in \eqref{eq:sym_prod_symmetry} accounts for the number
of ways to permute each set of shared indices on every tensor.
Altogether, the symmetry factors $\S\p{g}$ cancel out with the
$\sim M_j!$ prefactors in \eqref{eq:sym_prod_vec}, so
\begin{align}
  \prod_{j\in\ZZ_p} \sum_{k\in\C_N\p{M_j}} w_j\p{k} O_j\p{k}
  \EQPS \sum_{g\in\G\p{\m M}} w\p{g} O\p{g}.
  \label{eq:sym_prod_group}
\end{align}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Formalizing diagrams and reducing computational costs}
\label{sec:diagrams}

Diagrams such as \eqref{eq:venn_diagram} will play a major role in the
calculations in this section.  Here, we define these diagrams as
formal objects that we can use in mathematical expressions, enabling
us to systematically perform calculations that are otherwise
intractable.  We then derive rules to ``simplify'' these diagrams in
such a way as to reduce the computational cost of their numerical
evaluation.

The simplest diagrams have $g_S$ filled dots (``$\bullet$'') at the
intersection of the circles $j\in S\in\PP\p{\ZZ_p}$, and are simply
equal to the associated scalar $w\p{g}$ defined in
\eqref{eq:diagram_factors}, e.g.
\begin{align}
  \diagram{example_123}
  \equiv \sum_{\substack{a,b,c,\in\ZZ_N\\\p{d,e}\in\C_N\p{2}\\
      \abs{\set{a,b,c,d,e}}=5}}
  w_1\p{a,b,c} w_2\p{b,d,e} w_3\p{b,c,d,e},
\end{align}
where the restriction $\abs{\set{a,b,c,d,e}}=5$ denotes that all of
$a,b,c,d,e$ are distinct.  Such a diagram with $\abs{g}$ dots
nominally takes $\O\p{N^{\abs{g}}}$ time to compute.  In practice,
this computational cost can be prohibitive for performing numerical
simulations of systems with any appreciable size.  We therefore wish
to simplify diagrams in order to reduce their computational cost as
much as possible.  Our general strategy will be to replace constrained
sums that make all indices interdependent by unconstrained sums that
can be carried out independently, in sequence.  In order to represent
different constraints, we need to define diagrams in which filled dots
(``$\bullet$'') may be replaced by empty dots (``$\circ$'') or crosses
(``$\bm\times$'').

If a region of a diagram contains $F$ filled dots, those dots
correspond to indices that sum over $\C_N\p{F}$ with the constraint
that they are not equal to any other filled dots in a diagram.  $E$
empty dots in a region, meanwhile, correspond to indices that are
summed over $\C_N\p{E}$ without any additional constraints, e.g.
\begin{align}
  \diagram{example_o}
  \equiv \sum_{\substack{\p{a,b}\in\C_N\p{2}\\e\in\ZZ_N\\
      \abs{\set{a,b,e}}=3}}
  \sum_{\substack{\p{c,d}\in\C_N\p{2}\\f\in\ZZ_N}}
  v\p{a,b,c,d,e} w\p{e,f}.
\end{align}
Empty dots are therefore entirely independent of filled dots.
Crosses, meanwhile, are {\it entirely dependent} on filled dots:
``cross indices'' are summed {\it only} over the values of ``filled
dot indices'', e.g.
\begin{align}
  \diagram{example_x}
  \equiv \sum_{\substack{a,e\in\ZZ_N\\\abs{\set{a,e}}=2}}
  \sum_{b,c\in\set{a,e}} \sum_{d\in\ZZ_N}
  u\p{a,b,c} v\p{b,d,e} w\p{b,c,e}.
\end{align}
Empty dots and crosses allow us to decompose diagrams with a high
computational cost into different diagrams with a lower computational
cost.  We will essentially use two tricks to decompose diagrams:
eliminating filled dots (which will add empty dots and crosses), and
eliminating crosses (which will move around filled dots).

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Decomposing diagrams}

Given a diagram containing only dots (filled or empty), we can
decompose any filled dot into an empty dot and a cross.  For example,
\begin{align}
  \diagram{example_elim}
  = \diagram{example_elim_o}
  - \diagram{example_elim_x}
  \label{eq:example_elim}
\end{align}
where
\begin{align}
  \diagram{example_elim}
  \equiv \sum_{\substack{a,b,c\in\ZZ_N\\\abs{\set{a,b,c}}=3}}
  v\p{a,b} w\p{b,c},
\end{align}
\begin{align}
  \diagram{example_elim_o}
  \equiv \sum_{\substack{b,c\in\ZZ_N\\\abs{\set{b,c}}=2}}
  v\p{\circ,b} w\p{b,c},
  &&
  v\p{\circ,b} \equiv \sum_{a\in\ZZ_N} v\p{a,b},
  \label{eq:example_elim_o}
\end{align}
\begin{align}
  \diagram{example_elim_x}
  \equiv \sum_{\substack{b,c\in\ZZ_N\\\abs{\set{b,c}}=2}}
  \sum_{a\in\set{b,c}} v\p{a,b} w\p{b,c}.
\end{align}
The decomposition in \eqref{eq:example_elim} essentially breaks up a
sum over $a\in\ZZ_N\setminus\set{b,c}$ into a difference of sums over
$a\in\ZZ_N$ and $a\in\set{b,c}$.  The sum over $a\in\ZZ_N$ to compute
$v\p{\circ,b}$ has $\O\p{N^2}$ cost, and can be performed prior to
evaluating the diagram in \eqref{eq:example_elim_o}.  The
decomposition in \eqref{eq:example_elim} therefore splits one
$\O\p{N^3}$ diagram into two $\O\p{N^2}$ diagrams.

After decomposing a filled dot into an empty dot and a cross, the next
step is to immediately eliminate the cross.  To eliminate a cross from
a diagram, we first note that the corresponding index can ignore other
indices on tensors that contain the index; that is (pay attention to
the sum over $a$),
\begin{align}
  \diagram{example_elim_x}
  \equiv \sum_{\substack{b,c\in\ZZ_N\\\abs{\set{b,c}}=2}}
  \sum_{a\in\set{b,c}} v\p{a,b} w\p{b,c}
  = \sum_{\substack{b,c\in\ZZ_N\\\abs{\set{b,c}}=2}}
  \sum_{a\in\set{c}} v\p{a,b} w\p{b,c}.
\end{align}
For each remaining index addressed by a cross, meanwhile, the cross
simply forces the corresponding indices to be equal, which is
equivalent to moving a filled dot into a different region:
\begin{align}
  \diagram{example_elim_x}
  = 2 \diagram{example_elim_x_full}
  = 2 \sum_{\p{b,c}\in\C_N\p{2}} v\p{c,b} w\p{b,c}.
  \label{eq:example_elim_final}
\end{align}
The factor of 2 accounts for the fact that the left diagram sums over
$b,c\in\ZZ_N$, while the right diagram sums over
$\p{b,c}\in\C_N\p{2}$.  We can generally repeat the above process of
eliminating filled dots and crosses until only empty dots remain in a
diagram.  The only complication in carrying out this process is that
we have to manually keep track of symmetry factors at each step, such
as the factor of 2 in \eqref{eq:example_elim_final}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Symmetry factors}

As seen in \eqref{eq:example_elim_final}, the process of simplifying
diagrams generally involves symmetry factors that need to be kept
track of by hand.  Here we discuss the rules governing symmetry
factors that appear when decomposing diagrams.  In general,
eliminating a filled dot from a region with $F$ filled dots makes a
diagram pick up a factor of $1/F$, e.g.
\begin{align}
  \diagram{example_sym}
  = \f14 \diagram{example_sym_o}
  - \f14 \diagram{example_sym_x}.
\end{align}
This factor can be derived by replacing the sum over $\C_N\p{F}$ for
the filled dots within the region by a sum over $\ZZ_N^{F}$, which
picks up a factor of $1/F!$ to account for the number of ways to
permute $F$ values.  Setting aside one filled dot for replacement by
an empty dot and a cross, the sum over $\ZZ_N^{F-1}$ for the remaining
dots can be changed back to a sum over $\C_N\p{F-1}$, picking up a
factor of $\p{F-1}!$.  The overall factor picked up throughout this
procedure is therefore $\p{F-1}!/F!=1/F$.  Similarly, adding an empty
dot to a region with $E$ empty dots makes the diagram pick up a factor
of $\p{E+1}!/E!=E+1$, so
\begin{align}
  \diagram{example_sym_o}
  = \f23 \diagram{example_sym_oo}
  - \f13 \diagram{example_sym_ox}.
\end{align}
Finally, eliminating a cross by moving a filled dot from an ``old''
region with $F_{\t{old}}$ filled dots into a ``new'' region with
$F_{\t{new}}$ filled dots picks up an overall factor of
$F_{\t{new}}+1$, so
\begin{align}
  \diagram{example_sym_x}
  = 2 \diagram{example_sym_x_elim},
\end{align}
where the factor of $1/F_{\t{old}}$ that is acquired due to removing a
dot from the old region is canceled out by a factor of $F_{\t{old}}$
that accounts for the number of ways to move a dot from the old region
to the new one.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Matrix elements of individual multi-spin operators}

The process of constructing and simplifying diagrams to compute the
coefficients $w\p{g}$ of the diagrammatic operator product expansion
in \eqref{eq:sym_prod_group} is systematic enough to be converted into
an algorithm for execution on a computer.  The last step necessary to
automate the evaluation of \eqref{eq:sym_prod_group} is expansion of
the multi-spin operators $O\p{g}$ in a basis for the permutationally
symmetric manifold $\M_0$.  Without loss of generality, we consider a
single permutationally symmetric $M$-spin operator $Q$; our task is
essentially to find coefficients of the expansion
\begin{align}
  \P_0 Q \P_0
  = \sum_{a,b} \bk{a|Q|b} \op{a}{b},
\end{align}
where $\set{\ket{a}},\set{\ket{b}}$ are complete bases for $\M_0$, and
the choice of $M$ spins on which $Q$ acts is arbitrary.  In a system
of $N$ spins with $n$ states each, a suitable basis for $\M_0$ can be
labeled by the occupation number of each single-spin state, namely
$a=\p{a_1,a_2,\cdots,a_n}$ with each $a_j\ge 0$ and $\sum_ja_j=N$.
Written out explicitly,
\begin{align}
  \ket{a} = \f1{\sqrt{\C\p{a}}}
  \sum_{\substack{\t{distinct}\\\t{permutations}\\\Pi~\t{of}~\tilde a}}
  \Pi \ket{\tilde a},
  &&
  \C\p{a} \equiv \f{\p{\sum_j a_j}!}{\prod_ja_j!}
  &&
  \ket{\tilde a} \equiv \bigotimes_{j=1}^n \ket{j}^{\otimes a_j},
\end{align}
where the multinomial coefficient $\C\p{a}$ counts the number of
distinct ways to permute the tensor factors of $\ket{\tilde a}$, and
enforces $\bk{a|a}=1$.  We denote the set of all valid assignments of
$S$ spins to $n$ states by $\A_n\p{S}$, such that the standard basis
for the permutationally symmetric manifold of $S$ spins is
$\set{\ket{a}:a\in\A_n\p{S}}$.  Identifying this standard basis allows
us to expand
\begin{align}
  \bk{a|Q|b} = \sum_{\alpha,\beta\in\A_n\p{M}}
  \delta_{a-\alpha,b-\beta}
  \sqrt{\C\p{a-\alpha}\C\p{b-\beta}}
  \sqrt{\f{\C\p{\alpha}\C\p{\beta}}{\C\p{a}\C\p{b}}}
  \bk{\alpha|Q|\beta},
  \label{eq:multi_body_eval}
\end{align}
where the differences $a-\alpha$ and $b-\beta$ are understood to be
taken element-wise; $\delta_{a-\alpha,b-\beta}=1$ if
$a-\alpha=b-\beta$ and zero otherwise; and for ease of notation we
define $\C\p{c}\equiv 0$ if any entries of $c$ are negative.  We sum
over both $\alpha$ and $\beta$ above merely to keep the expression
symmetric with respect to transposition; in practice, one can simply
sum over $\alpha\in\A_n\p{M}$ and set $\beta\equiv b-a+\alpha$.  Note
that, by slight abuse of notation, the operator $Q$ on the left of
\eqref{eq:multi_body_eval} acts on an arbitrary choice of $M$ spins
(out of $N$), whereas the operator $Q$ on the right of
\eqref{eq:multi_body_eval} is simply an $M$-spin operator, with matrix
elements $\bk{\alpha|Q|\beta}$ evaluated with respect to the $M$-spin
states $\ket\alpha,\ket\beta$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Two single-body operators}
\label{sec:PXYP}

Here we simplify the product
\begin{align}
  \P_0 \sp{\sum_{p,q} v_p w_q X_p Y_q} \P_0
  \EQPS \diagram{single_body_0} X_1 Y_2
  + \diagram{single_body_1} X_1 Y_1,
  \label{eq:PXYP_start}
\end{align}
where $\P_0$ is a projector onto the permutationally symmetric
manifold $\M_0$; $p,q$ index individual spins; $v_p,w_p$ are scalars;
and $X,Y$ are single-spin operators.  This product appears, for
example, in the calculation of the second-order effective Hamiltonian
$H_1^{(2)}$ induced on the permutationally symmetric manifold $\M_0$
by the single-body perturbation $\V_1$ in \eqref{eq:perturbations}.
Defining
\begin{align}
  \v m \equiv \sum_p m_p \ket{p},
  &&
  \col{m} \equiv \sum_p m_p,
\end{align}
for $m\in\set{v,w}$, we can simplify
\begin{align}
  \diagram{single_body_1}
  \equiv \sum_p v_p w_p
  = \v v\c\v w,
\end{align}
and
\begin{align}
  \diagram{single_body_0}
  = \diagram{single_body_0_o} - \diagram{single_body_0_x}
  = \diagram{single_body_0_oo} - \diagram{single_body_1}
  = \col{u}\,\col{v} - \v v \c\v w,
\end{align}
so
\begin{align}
  \sum_{p,q} v_p w_q X_p Y_q
  \EQPS \col{u}\,\col{v} X_1 Y_2 - \v v\c\v w \p{X_1 Y_2 - X_1 Y_1},
\end{align}
In order to write this result in terms of collective operators
$\col{Z} \equiv \sum_p Z_p$, we expand
\begin{align}
  \col{X Y} \EQPS N X_1 Y_1,
  &&
  \col{X}\,\col{Y} \EQPS \col{XY} + N\p{N-1} X_1 Y_2,
\end{align}
which implies that
\begin{align}
  \sum_{p,q} v_p w_q X_p Y_q
  \EQPS \f{\col{u}\,\col{v}}{N\p{N-1}}
  \p{\col{X}\,\col{Y} - \col{XY}}
  - \f{\v v \c\v w}{N\p{N-1}}
  \p{\col{X}\,\col{Y} - N\col{XY}}.
\end{align}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Two two-body operators}
\label{sec:POQP}

Here we simplify the product
\begin{multline}
  \P_0 \sp{\sum_{k<\ell} \sum_{p<q}
    v_{k\ell} w_{pq} O_{k\ell} Q_{pq}} \P_0 \\
  \EQPS \diagram{two_body_0} O_{1,2} Q_{3,4}
  + \diagram{two_body_1} O_{1,2} Q_{1,3}
  + \diagram{two_body_2} O_{1,2} Q_{1,2},
  \label{eq:POQP_start}
\end{multline}
where $\P_0$ is a projector onto the permutationally symmetric
manifold $\M_0$; $k,\ell,p,q$ index individual spins;
$v_{k\ell},w_{pq}$ are scalar coefficients with $m_{pq}=m_{qp}$ and
$m_{pp}=0$ for each of $m\in\set{v,w}$; and $O,Q$ are permutationally
symmetric two-spin operators.  This product appears, for example, in
the calculation of the second-order effective Hamiltonian $H_2^{(2)}$
induced on the permutationally symmetric manifold $\M_0$ by the
two-body perturbation $\V_2$ in \eqref{eq:perturbations} in
\eqref{eq:perturbations}.  Defining
\begin{align}
  \v{\m m} \equiv \sum_{p<q} m_{pq} \ket{\set{p,q}},
  &&
  \v m \equiv \sum_p m_p \ket{p},
  &&
  m_p \equiv \sum_q m_{pq},
  &&
  \col{m} \equiv \sum_{p<q} m_{pq},
\end{align}
for $m\in\set{v,w}$, we can write
\begin{align}
  \diagram{two_body_2} \equiv \sum_{\p{p,q}\in\C_N\p{2}} v_{pq} w_{pq}
  = \v{\m v} \c\v{\m w},
\end{align}
and simplify
\begin{align}
  \diagram{two_body_1}
  &= \sp{\diagram{two_body_1_o}} - \sp{\diagram{two_body_1_x}} \\
  &= \sp{\diagram{two_body_1_oo} - \diagram{two_body_1_ox}}
  - \sp{2\diagram{two_body_2}} \label{eq:mid_zero} \\
  &= \v v \c \v w - 2 \v{\m v} \c \v{\m w},
\end{align}
where the middle diagram in \eqref{eq:mid_zero} contains an empty sum
for the cross, and is therefore equal to zero.  Finally, with a bit of
more work (or a computer) we can work out that
\begin{align}
  \diagram{two_body_0}
  = \diagram{two_body_0_oooo} - \diagram{two_body_1_ooo}
  + \diagram{two_body_2_oo}
  = \col{v}\,\col{w} -\v v\c\v w + \v{\m v}\c\v{\m w}.
\end{align}
Altogether,
\begin{multline}
  \sum_{k<\ell} \sum_{p<q} v_{k\ell} w_{pq} O_{k\ell} Q_{pq} \\
  \EQPS \p{\col{v}\,\col{w} -\v v\c\v w + \v{\m v}\c\v{\m w}}
  O_{1,2} Q_{3,4}
  + \p{\v v\c\v w - 2 \v{\m v} \c \v{\m w}} O_{1,2} Q_{1,3}
  + \v{\m v} \c \v{\m w}\, O_{1,2} Q_{1,2}.
  \label{eq:POQP}
\end{multline}
In the special case that $O=Q=X\otimes X$ with $X^2=1$, we can further
simplify
\begin{align}
  \sum_{k<\ell} \sum_{p<q} v_{k\ell} w_{pq} X_k X_\ell X_p X_q
  \EQPS
  \p{\col{v}\,\col{w} -\v v\c\v w + \v{\m v}\c\v{\m w}} X^{\otimes 4}
  + \p{\v v\c\v w - 2 \v{\m v} \c \v{\m w}} X^{\otimes 2}
  + \v{\m v}\c\v{\m w}.
\end{align}
In terms of collective operators $\col{X} \equiv \sum_p X_p$, we then
have
\begin{multline}
  \sum_{k<\ell} \sum_{p<q} v_{k\ell} w_{pq} X_k X_\ell X_p X_q \\
  \EQPS
  \f{\col{v}\,\col{w} -\v v\c\v w + \v{\m v}\c\v{\m w}}{N!_4}
  \sp{\col{X}^4 - 2\p{3N-4} \col{X}^2}
  + \f{\p{\v v\c\v w - 2 \v{\m v} \c \v{\m w}}}{N!_2}\, \col{X}^2 \\
  + \f{3\,\col{v}\,\col{w} - N \v v\c\v w
    + N\p{N-2}\v{\m v}\c\v{\m w}}{\p{N-1}\p{N-3}},
\end{multline}
where
\begin{align}
  N!_k \equiv \prod_{j=0}^{k-1} \p{N-j} = \f{N!}{\p{N-k}!}
\end{align}
denotes a falling factorial.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Three two-body Ising-like operators}

Here we simplify the product
\begin{align}
  \X \equiv \P_0 \sp{\sum_{k<\ell} \sum_{p<q} \sum_{r<s}
    u_{k\ell} v_{pq} w_{rs} X_k X_\ell X_p X_q X_r X_s} \P_0,
  &&
  X^2 = 1,
\end{align}
where $\P_0$ is a projector onto the permutationally symmetric
manifold $\M_0$; $k,\ell,p,q,r,s$ index individual spins; $X$ is a
single-spin operator; and $u_{k\ell},v_{pq},w_{rs}$ are scalar
coefficients with $m_{pq}=m_{qp}$ and $m_{pp}=0$ for each of
$m\in\set{u,v,w}$.  Collecting terms according to the number of $X$
operators that remain after accounting for $X^2=1$, we find that
\begin{align}
  \X \EQPS A_6 X^{\otimes 6} + A_4 X^{\otimes 4}
  + A_2 X^{\otimes 2} + A_0,
  \label{eq:triple_multi}
\end{align}
with
\begin{align}
  A_6 \equiv \diagram{triple_0},
  &&
  A_4 \equiv \diagram{triple_01} + \diagram{triple_1},
  &&
  A_0 \equiv \diagram{triple_0111},
  \label{eq:triple_64}
\end{align}
\begin{align}
  A_2 \equiv \diagram{triple_011} + \diagram{triple_02}
  + \diagram{triple_11} + \diagram{triple_2},
  \label{eq:triple_2}
\end{align}
where a diagram with unlabeled circles denotes a sum over all distinct
label assignments, e.g.
\begin{align}
  \diagram{triple_1} \equiv \diagram{triple_1_uvw},
  \label{eq:triple_uvw}
\end{align}
\begin{align}
  \diagram{triple_011}
  \equiv \diagram{triple_011_uvw}
  + \diagram{triple_011_vwu} + \diagram{triple_011_wuv}.
  \label{eq:triple_uvw_3}
\end{align}
The first diagram in each of $A_6,A_4,A_2,A_0$ as written in
\eqref{eq:triple_64}, \eqref{eq:triple_2} thus has only one assignment
of labels, as in \eqref{eq:triple_uvw}, while all other unlabeled
diagrams have three assignments, as in \eqref{eq:triple_uvw_3}.

Having identified diagrammatic representations of the coefficients
$A_6,A_4,A_2,A_0$, we now need to simplify all diagrams to reduce
their computational complexity, as discussed in Section
\ref{sec:diagrams}.  Simplifying all these diagrams by hand is
tedious, but the process of eliminating filled dots and crosses from a
diagram is algorithmic enough to execute on a computer, doing which we
find
\begin{align}
  A_6 = D_6 - D_4 + D_2 - D_0,
  &&
  A_4 = D_4 - 2 D_2 + 3 D_0,
  &&
  A_2 = D_2 - 3 D_0,
  &&
  A_0 \equiv D_0,
\end{align}
where
\begin{align}
  D_6 \equiv \diagram{triple_0_o},
  &&
  D_4 \equiv \diagram{triple_01_o} - 2 \diagram{triple_1_o},
  &&
  D_0 \equiv \diagram{triple_0111_o},
\end{align}
\begin{align}
  D_2 \equiv \diagram{triple_011_o}
  + \diagram{triple_02_o}
  - 2 \diagram{triple_11_o}
  + 4 \diagram{triple_2_o}.
\end{align}
Defining, for each of $m\in\set{u,v,w}$,
\begin{align}
  \m m \equiv \sum_{p,q} m_{pq} \op{p}{q},
  &&
  \v{\m m} \equiv \sum_{p<q} m_{pq} \ket{\set{p,q}},
  &&
  \v m \equiv \sum_p m_p \ket{p},
  &&
  m_p \equiv \sum_q m_{pq},
  &&
  \col{m} \equiv \sum_{p<q} m_{pq},
\end{align}
we can expand
\begin{align}
  D_6 = \col{u}\,\col{v}\,\col{w},
  &&
  D_4 = \col{u}\,\v v\c\v w + \col{v}\,\v w\c\v u
  + \col{w}\,\v u\c\v v - 2 \sum_p u_p v_p w_p,
  &&
  D_0 = \tr\p{\m u \c \m v \c \m w},
\end{align}
\begin{multline}
  D_2 = \v u \c\m v\c\v w + \v v \c\m w\c\v u + \v w \c\m u\c\v v
  + \col{u}\,\v{\m v}\c\v{\m w} + \col{v}\,\v{\m w}\c\v{\m u}
  + \col{w}\,\v{\m u}\c\v{\m v} \\
  - 2 \sum_{p,q} \p{u_p v_{pq} w_{pq}
    + v_p w_{pq} u_{pq} + w_p u_{pq} v_{pq}}
  + 4 \sum_{p<q} u_{pq} v_{pq} w_{pq}.
\end{multline}
Finally, we can also write the product $\X$ in \eqref{eq:triple_multi}
in terms of the collective operator $\col{X} \equiv \sum_p X_p$:
\begin{align}
  \X \EQPS
  \tilde A_6 \col{X}^6 + \tilde A_4 \col{X}^4
  + \tilde A_2 \col{X}^2 + \tilde A_0,
  \label{eq:triple_col}
\end{align}
where
\begin{align}
  \tilde A_6 \equiv \f{A_6}{N!_6},
  &&
  \tilde A_4 \equiv \f{A_4}{N!_4} - 5\p{3N-8} \f{A_6}{N!_6},
\end{align}
\begin{align}
  \tilde A_2 \equiv \f{A_2}{N!_2} - 2\p{3N-4} \f{A_4}{N!_4}
  + \p{45N^2-210N+184} \f{A_6}{N!_6},
\end{align}
\begin{align}
  \tilde A_0 \equiv A_0 - \f{A_2}{N-1}
  + \f{3A_4}{\p{N-1}\p{N-3}}
  - \f{15A_6}{\p{N-1}\p{N-3}\p{N-5}}.
\end{align}

\bibliography{multilevel_spin_notes.bib}

\end{document}
